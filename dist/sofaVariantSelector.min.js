/**
 * angular-sofa-variant-selector - v0.1.0 - Tue Dec 23 2014 17:01:14 GMT+0100 (CET)
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO)
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(e){e.module("sofa-variant-selector.tpl.html",[]).run(["$templateCache",function(e){e.put("sofa-variant-selector.tpl.html",'<ul class="sofa-variant-selector" ng-if="variants.length">\n    <li class="sofa-variant-selector__item" ng-repeat="property in properties">\n        <label class="sofa-variant-selector__label" ng-bind="property.label"></label>\n        <cc-select-box\n                model="selectedProperties[property.name]"\n                data="data[property.name]"\n                choose-text="property.label"\n                property-name="variant_{{property.name}}">\n        </cc-select-box>\n    </li>\n</ul>\n')}]),e.module("sofa.variantSelector",["sofa-variant-selector.tpl.html","sofa.selectBox"]),e.module("sofa.variantSelector").filter("sofaVariantFilter",["$filter",function(e){"use strict";return function(t,r,a){var n={properties:{}},o=!1;for(var i in r)a!==i&&null!==r[i]&&void 0!==r[i]&&(n.properties[i]=r[i],o=!0);var l=function(e,t){if(e&&t&&"object"==typeof e&&"object"==typeof t){for(var r in t)if(e[r]!==t[r])return!1;return!0}},s=o?e("filter")(t,n,l):t,c=[];return s.forEach(function(e){-1===c.indexOf(e.properties[a])&&e.stock>0&&c.push(e.properties[a])}),c}}]).directive("sofaVariantSelector",["$filter","localeService",function(t,r){"use strict";return{restrict:"E",replace:!0,scope:{variants:"=",variant:"=?",selectedProperties:"=?",chooseText:"=?"},templateUrl:"sofa-variant-selector.tpl.html",link:function(a){a.properties={},a.selectedProperties=a.selectedProperties||{},a.data={};var n=function(e){return t("sofaVariantFilter")(a.variants,a.selectedProperties,e)},o=function(){e.forEach(a.properties,function(e){a.data[e.name]=n(e.name)})},i=function(e,t){var r=e.filter(function(e){for(var r in e.properties)if(e.properties[r]!==t[r])return!1;return!0});return r.length?r[0]:null};a.variants.forEach(function(e){for(var t in e.properties)a.selectedProperties[t]=null,a.properties[t]||(a.properties[t]={name:t,label:r.getTranslation("variantSelector."+t)||t})}),a.$watch("selectedProperties",function(e){a.variant=i(a.variants,e),o()},!0)}}}])}(angular);